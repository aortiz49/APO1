/**~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 * Universidad de los Andes (Bogotá - Colombia)
 * Departamento de Ingeniería de Sistemas y Computación 
 * Licenciado bajo el esquema Academic Free License version 2.1 
 *
 * Proyecto Cupi2 (http://cupi2.uniandes.edu.co)
 * Ejercicio: n6_visorImagen
 * Autor: Equipo Cupi2 2017
 * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ 
 */
package uniandes.cupi2.visorImagen.interfaz;

import java.awt.BorderLayout;
import java.awt.Color;
import java.awt.GridLayout;
import java.io.File;

import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.UIManager;

/**
 * Interfaz del visor de imágenes.
 */
@SuppressWarnings("serial")
public class InterfazVisorImagen extends JFrame
{
    // -----------------------------------------------------------------
    // Constantes
    // -----------------------------------------------------------------

    /**
     * Dimensión para la convolución.
     */
    public static final int DIMENSION_CONVOLUCION = 3;

    // -----------------------------------------------------------------
    // Atributos
    // -----------------------------------------------------------------

    /**
     * Panel del banner de la aplicación.
     */
    private PanelBanner panelBanner;

    /**
     * Panel de la imagen.
     */
    private PanelImagen panelImagen;

    /**
     * Panel de los botones.
     */
    private PanelBotones panelBotones;

    /**
     * Panel de los botones.
     */
    private PanelCargarImagen panelCargarImagen;

    // -----------------------------------------------------------------
    // Constructores
    // -----------------------------------------------------------------

    /**
     * Crea la interfaz para el visor de imágenes.
     */
    public InterfazVisorImagen( )
    {
        setTitle( "Visor de imágenes" );
        setSize( 731, 700 );
        setDefaultCloseOperation( JFrame.EXIT_ON_CLOSE );

        // Establece el distribuidor gráfico
        setLayout( new BorderLayout( ) );

        // Crea y adiciona el panel del banner
        panelBanner = new PanelBanner( );
        add( panelBanner, BorderLayout.NORTH );

        // Crea y adiciona el panel de la imagen
        panelImagen = new PanelImagen( );
        add( panelImagen, BorderLayout.CENTER );

        JPanel panel = new JPanel( );
        panel.setLayout( new GridLayout( 2, 1 ) );

        // Crea y adiciona el panel de cargar la imagen

        panelCargarImagen = new PanelCargarImagen( this );
        panel.add( panelCargarImagen );

        // Crea y adiciona el panel de botones

        panelBotones = new PanelBotones( this );
        panel.add( panelBotones );

        add( panel, BorderLayout.SOUTH );

        setLocationRelativeTo( null );
        setResizable( false );
    }

    // -----------------------------------------------------------------
    // Métodos
    // -----------------------------------------------------------------

    /**
     * Escoge la imagen de la ruta que quieres cargar.
     */
    public void cargarImagen( )
    {
        JFileChooser fc = new JFileChooser( "./data" );
        int response = fc.showOpenDialog( this );
        if( response == JFileChooser.APPROVE_OPTION )
        {
            File file = fc.getSelectedFile( );
            panelImagen.actualizarImagen( file.getAbsolutePath( ) );
            panelCargarImagen.actualizarRuta( file.getAbsolutePath( ) );

        }
        else
        {
            JOptionPane.showMessageDialog( this, "No se ha elegido ninguna imagen" );
        }
    }

    /**
     * Da el color promedio de la imagen.
     * @return El color promedio.
     */
    public Color colorPromedio( )
    {
        return panelImagen.colorPromedio( );
    }

    /**
     * Convierte la imagen en su negativo.
     */
    public void convertirNegativo( )
    {
        panelImagen.convertirNegativo( );
    }

    /**
     * Refleja la imagen.
     */
    public void reflejarImagen( )
    {
        panelImagen.reflejarImagen( );
    }

    /**
     * Presenta el diálogo de definición del umbral de binarización.
     */
    public void presentarDialogoUmbral( )
    {
        DialogoUmbralBinarizacion dialogoUmbral = new DialogoUmbralBinarizacion( this );
        dialogoUmbral.setVisible( true );
    }

    /**
     * Binariza la imagen.
     * @param pUmbral Umbral de binarización.
     */
    public void binarizarImagen( double pUmbral )
    {
        panelImagen.binarizarImagen( pUmbral );
    }

    /**
     * Pixela la imagen.
     */
    public void pixelarImagen( )
    {
        panelImagen.pixelarImagen( );
    }

    /**
     * Convierte a tonos de gris la imagen.
     */
    public void convertirAGrises( )
    {
        panelImagen.convertirAGrises( );
    }

    /**
     * Presenta el diálogo de definición de la matriz de convolución.
     */
    public void presentarDialogoMatrizConvolucion( )
    {
        DialogoMatrizConvolucion dialogoMatriz = new DialogoMatrizConvolucion( this );
        dialogoMatriz.setVisible( true );
    }

    /**
     * Aplica el operador de convolución representado en la matriz.
     * @param pConv Matriz de convolución.
     */
    public void aplicarOperadorConvolucion( double pConv[][] )
    {
        panelImagen.aplicarOperadorConvolucion( pConv );
    }

    // -----------------------------------------------------------------
    // Puntos de Extensión
    // -----------------------------------------------------------------

    /**
     * Extensión 1.
     */
    public void reqFuncOpcion1( )
    {
        panelImagen.extension1( );
    }

    /**
     * Extensión 2.
     */
    public void reqFuncOpcion2( )
    {
        panelImagen.extension2( );
    }

    // -----------------------------------------------------------------
    // Main
    // -----------------------------------------------------------------

    /**
     * Ejecuta la aplicación.
     * @param pArgs Parámetros de la ejecución. No son necesarios.
     */
    public static void main( String[] pArgs )
    {
        try
        {
            // Unifica la interfaz para Mac y para Windows.
            UIManager.setLookAndFeel( UIManager.getCrossPlatformLookAndFeelClassName( ) );

            InterfazVisorImagen i = new InterfazVisorImagen( );
            i.setVisible( true );
        }
        catch( Exception e )
        {
            e.printStackTrace( );
        }
    }
}
